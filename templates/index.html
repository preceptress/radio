<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WFMU Playlist Capture</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
</head>
<body class="bg-light p-4">
<div class="container">
  <h1 class="mb-4">WFMU Playlist Capture</h1>

  <div class="card p-3 mb-4 shadow-sm">
    <label for="wfmu_url" class="form-label">Enter WFMU playlist URL</label>
    <input type="text" id="wfmu_url" class="form-control mb-3"
           placeholder="https://wfmu.org/playlists/shows/154876">
    <button id="startBtn" class="btn btn-primary">Start</button>
  </div>

  <div id="output" class="card p-3 shadow-sm" style="display:none;">
    <h5>Results:</h5>
    <pre id="results" class="bg-dark text-light p-3 rounded" style="height:300px; overflow-y:auto;"></pre>
  </div>

  <div id="errorBox" class="alert alert-danger mt-3" style="display:none;"></div>
  <div id="doneBox" class="alert alert-success mt-3" style="display:none;">âœ… Done!</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const socket    = io();
  const startBtn  = document.getElementById("startBtn");
  const urlInput  = document.getElementById("wfmu_url");
  const resultsEl = document.getElementById("results");
  const outCard   = document.getElementById("output");
  const errBox    = document.getElementById("errorBox");
  const doneBox   = document.getElementById("doneBox");

  startBtn.addEventListener("click", () => {
    const url = urlInput.value.trim();
    resultsEl.textContent = "";
    errBox.style.display = "none";
    doneBox.style.display = "none";

    if (!/^https?:\/\//i.test(url)) {
      errBox.textContent = "Please enter a valid WFMU URL.";
      errBox.style.display = "block";
      return;
    }

    outCard.style.display = "block";
    resultsEl.textContent = "Fetching playlist...\n";
    socket.emit("start_wfmu", { url });
  });

  socket.on("track", (data) => {
    resultsEl.textContent += data.line + "\n";
    resultsEl.scrollTop = resultsEl.scrollHeight;
  });

  socket.on("error", (data) => {
    errBox.textContent = data.message || "An error occurred.";
    errBox.style.display = "block";
  });

  socket.on("done", () => { doneBox.style.display = "block"; });
});
</script>
</body>
</html>